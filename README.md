## Perkenalan

[中文](./README_zh.md)

`js2pyadalah paket python populer yang dapat mengevaluasi kode javascript di dalam juru bahasa python. Ini digunakan oleh berbagai web scraper untuk mengurai kode javscript di situs web.

Terdapat kerentanan dalam implementasi variabel global di dalamnya js2py, yang memungkinkan penyerang memperoleh referensi ke objek python di lingkungan js2py, sehingga memungkinkan penyerang untuk keluar dari lingkungan js dan menjalankan perintah sewenang-wenang pada host.

Biasanya pengguna akan memanggil js2py.disable_pyimport()untuk menghentikan kode javascript keluar dari js2pylingkungan. Namun dengan kerentanan ini, penyerang dapat menghindari pembatasan ini dan menjalankan perintah apa pun pada host.

Pelaku ancaman dapat menghosting situs web yang berisi file js berbahaya atau mengirim skrip berbahaya melalui HTTP API agar korban dapat menguraikannya. Dengan melakukan itu, aktor dapat melakukan eksekusi kode jarak jauh pada host dengan menjalankan perintah shell apa pun pada target.

## Detail kerentanan

-Nomor versi komponen yang terpengaruh:
-js2py terbaru (<=0.74) yang berjalan di bawah python 3
- affected products:
  - [pyload/pyload](https://github.com/pyload/pyload)
  - [VeNoMouS/cloudscraper](https://github.com/VeNoMouS/cloudscraper) (use js2py as a optional 'js interpreter')
  - [dipu-bd/lightnovel-crawler](https://github.com/dipu-bd/lightnovel-crawler)
- The steps to reproduce:
  - install python3 under 3.12, currently `js2py` don't support python3.12.
  - Run `pip install js2py` to install `js2py` and execute `poc.py`, which would try to execute `head -n 1 /etc/passwd; calc; gnome-calculator; kcalc;` on the host.
  - If the vulnerability exists the script should print `Success! the vulnerability exists...` or pop up calculator.

## Fix

Currently official fix is unavailable, user can use `fix.py` to dynamically patch js2py or use patch.txt to fix the source code.

## Others

I found this vulnerability in Feburary, and submit a PR to the official repo. But after that, the PR is being forgot and four months have passed, I decide to release the PoC and the fix now.
